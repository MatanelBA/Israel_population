---
title: "R Notebook"
output: html_notebook
---

שינוי בהרכב הגילאים בישראל במהלך שנות האלפיים

```{r}

library(pacman)
p_load(tidyverse, openxlsx, readxl, utf8, ggplot2, scales, magrittr)
p_load(ggplot2, ggridges, ggpubr, scales, cowplot,viridisLite, viridis, RColorBrewer,ggsci,ggthemes,patchwork,scales )


getwd()

```

דבר ראשון, צריך להפריד בין יהודים לערבים. היה טוב אם הייתי יכול להפריד גם בין עולים מרוסיה לבין שאר האוכלוסייה, אבל זה קשה לביצוע במסגרת הדאטה שלי

בגלל ההבדל בגודל האוכלוסיות, טוב להראות גם את המספרים המוחלטים וגם את האחוזים

```{r}

p_population_grouop_num <- population_2000_2020_int %>%
filter( population_group %in% c("arab_total", "jews_and_others_total"), year == 2020  ) %>%
ggplot(aes(age, number, color = population_group)) +
         geom_path()+
  theme_bw() +
#    scale_color_brewer(type = "qual" ,palette = "Set1")+
  scale_colour_manual(values = c("#4DAF4A", "#377EB8" ))+ #השתמשתי בהגדרה ידנית מתוך הפלטה כדי שהצבעים יתאימו אינטואיטיבית כחול יהודים וירוק ערבים. היה טוב אם הייתה דרך לדלג על צבע בפלטה אבל לא מצאתי כזאת ולכן הגדרתי ידנית
  theme(panel.grid.minor = element_blank())  +
  scale_y_continuous(n.breaks = 8, labels = label_comma())  + 
scale_x_continuous(n.breaks = 8) 

p_population_grouop_prc <- population_2000_2020_int %>%
filter( population_group %in% c("arab_total", "jews_and_others_total"), year == 2020  ) %>%
ggplot(aes(age, prc_of_group, color = population_group)) +
         geom_path()+
  theme_bw() +
  scale_colour_manual(values = c("#4DAF4A", "#377EB8" ))+
  theme(panel.grid.minor = element_blank())  +
  scale_y_continuous(n.breaks = 8, label = label_percent())  + 
scale_x_continuous(n.breaks = 8) 

p_population_grouop_area <- population_2000_2020_int %>%
    filter( population_group %in% c("arab_total", "jews_and_others_total"), year == 2020  ) %>% group_by( age) %>%
     summarise(population_group = population_group,
               age = age,
               percentage = number/ sum(number)) %>% ungroup() %>%
     ggplot(aes(age, percentage, fill = population_group)) +
     geom_area( color = "black")  +
     theme_bw() +
     scale_fill_manual(values = c("#4DAF4A", "#377EB8" ))+
     theme(panel.grid.minor = element_blank())  +
     scale_y_continuous(n.breaks = 8, labels = label_percent())  + 
     scale_x_continuous(n.breaks = 8) 

#plot_grid(p_population_grouop_num,p_population_grouop_prc)
p_population_grouop_num
p_population_grouop_prc
p_population_grouop_area


```

כל זה היה רק בשביל להראות את החשיבות של החלוקה בין האוכלוסייה היהודית לבין האוכלוסייה הערבית. עכשיו נשווה בין תחילת וסוף כל עשור: 2000, 2010, 2020

```{r}
population_2000_2010_2020_int <- population_2000_2020_int %>%
filter( population_group %in% c("arab_total", "jews_and_others_total"), year %in%c(2000, 2010,2020) )    

population_2000_2010_2020_int %>%
  ggplot(aes(age,prc_of_group , fill = population_group)) +
  geom_line(color = "black") +
  geom_area()+
  facet_grid(year~population_group ) +
  geom_vline(data = filter(population_2000_2020_sum, population_group %in% c("arab_total", "jews_and_others_total"), year  %in%c(2000, 2010,2020)), aes( xintercept = median), color = "white",  size = 0.5) +
   geom_text(data = filter(population_2000_2020_sum, population_group %in% c("arab_total", "jews_and_others_total"), year  %in%c(2000, 2010,2020)), aes( x = median,y = 0.005, label = round(median) ), color = "white", nudge_x = 5) +
  theme_bw()+
    scale_fill_manual(values = c("#4DAF4A", "#377EB8" ))+
     theme(panel.grid.minor = element_blank())  +
     scale_y_continuous(n.breaks = , labels = label_percent(accuracy = 1))  
```

זה לא כל כך נוח לקריאה כי הקווים עושים רושם של ספגטי

ננסה לעשות את אותו הדבר עם קבוצות גיל

```{r}
population_2000_2010_2020_age_groups <- population_2000_2020_age_groups %>%
filter( population_group %in% c("arab_total", "jews_and_others_total"), year %in%c(2000, 2010,2020), !(age  %in% c("TOTAL", "90+", "95+", "90-94") )    )

population_2000_2010_2020_age_groups %>%
  filter( population_group == "jews_and_others_total") %>%
  ggplot(aes(age,prc_of_group, group = year, fill = year)) +
  facet_grid(year~.)+
geom_col() +
  coord_flip()

population_2000_2010_2020_age_groups %>%
  filter( population_group == "arab_total") %>%
  ggplot(aes(age,prc_of_group, group = year, fill = year)) +
  facet_grid(year~.)+
geom_col() +
  coord_flip()


```

ההבדלים לא מספיק ברורים לעין.

אפשר אולי להשתמש ב-ridgplot

```{r}



population_2000_2010_2020_int %>%
  filter( population_group == "arab_total") %>%
  ggplot(aes(age,year, height = prc_of_group, fill = year, group = year)) +
 # geom_density_ridges (aes( height = prc_of_group), stat = "identity" , scale = 1)
  geom_ridgeline(scale = 15)+
    scale_y_discrete(expand = c(0.05, 0)) 
 #  geom_vline(data = filter(population_2000_2020_sum, population_group == "arab_total", year  %in%c(2000, 2010,2020)), aes( xintercept = median), color = "black",  size = 1) נראה שזה לא יכול לעבוד עם גרף קווי מפה. 

#stat_density_ridges(aes( height = prc_of_group) , scale = 1, quantile_lines = TRUE, quantiles = 2)
```

נראה לי שההבדל בין השנים פשוט לא מספיק גדול בשביל לראות אותו בין התפלגויות שלמות. נראה לי שהפתרון הוא פשוט לחשב הפרשים.

בשביל זה צריך להעביר קודם

```{r}
population_2000_2010_2020_age_groups %>%
  mutate(dif_2000_2010 = )
```
