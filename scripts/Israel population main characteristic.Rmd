---
title: "Israel_population_main_characteristic"
output:  word_document
---

במחברת הזאת אני רוצה להציג את התכונות העיקריות של אוכלוסיית ישראל.

```{r}
library(pacman)
p_load(dplyr, openxlsx, readxl,readr, tidyr, utf8)
p_load(ggplot2, ggridges, ggpubr, scales, cowplot,viridisLite, viridis, RColorBrewer,ggsci,ggthemes,patchwork,scales )

#source("C:/Users/OWNER/Dropbox/projects/Israel population/scripts/load data.R", local	= TRUE)


```

```{r}


population_2000_2020_int <- population_2000_2020 %>%
  filter(age %in% 0:74) %>%
mutate(age = as.double(age)) %>%
  arrange(population_group, year,age)


```

בתור התחלה נציג את התפלגות הגילים של כלל אוכלוסיית ישראל בשנה המעודכנת ביותר שיש לי - שנת 2020

```{r}
p_general_distribution <- population_2000_2020_int %>%
  filter( population_group == "all_total", year == 2019) %>%
  ggplot(aes(age,number)) +
  geom_path() +
  theme_bw() +
  theme(panel.grid.minor = element_blank())

p_general_distribution


#ggsave("C:/R_projects/Israel popultion/plots/general_distribution.png")

```

אחרי שהצגנו את כל האוכלוסייה יחד, הגיוני לחלק אותה לשתי אוכלוסיות המשנה העיקריות: יהודים וערבים

```{r}

p_population_grouop <- population_2000_2020_int %>%
filter( population_group %in% c("arab_total", "jews_and_others_total"), year == 2019  ) %>%
ggplot(aes(age,number, color = population_group)) +
         geom_path()+
  theme_bw() +
#    scale_color_brewer(type = "qual" ,palette = "Set1")+
  scale_colour_manual(values = c("#4DAF4A", "#377EB8" ))+ #השתמשתי בהגדרה ידנית מתוך הפלטה כדי שהצבעים יתאימו אינטואיטיבית כחול יהודים וירוק ערבים. היה טוב אם הייתה דרך לדלג על צבע בפלטה אבל לא מצאתי כזאת ולכן הגדרתי ידנית
  theme(panel.grid.minor = element_blank())  +
  scale_y_continuous(n.breaks = 8, labels = label_comma())  + 
scale_x_continuous(n.breaks = 8)

p_population_grouop

```

כאן אני רוצה להראות את התפלגות הגילים השונה של כל מגדר, ואת היחס בין גברים לנשים לפי גיל בהתחלה עשיתי את זה עבור יהודים וערבים בנפרד אבל בדיעבד לא נראה לי שיש בזה טעם.

```{r eval=FALSE, include=FALSE}
p_jews_gender<- population_2000_2020_int %>%
  filter( population_group %in% c("jews_and_others_male","jews_and_others_female"),
          year == 2019) %>%
  ggplot(aes(age,number, color = population_group)) +
  geom_path()+
  scale_color_brewer(palette = "Set1")+
  theme_pubr()

p_arabs_gender<- population_2000_2020_int %>%
  filter( population_group %in% c("arab_male","arab_female"),
          year == 2019) %>%
  ggplot(aes(age,number, color = population_group)) +
  geom_path()+
  scale_color_brewer(palette = "Set1")+
  theme_pubr()


plot_grid(p_jews_gender, p_arabs_gender)

#ggsave("C:/R_projects/Israel popultion/plots/jews_by_gender.png")

```

התרשים הזה מראה בצורה טובה יותר את היחס בין גברים לנשים לפי קבוצת גיל: בלידה יש

```{r}
p_all_gender<- population_2000_2020_int %>%
  filter( population_group %in% c("all_male","all_female"),
          year == 2019) %>%
  ggplot(aes(age,number, color = population_group)) +
  geom_path()+
  scale_color_brewer(palette = "Set1")+
   scale_x_continuous(breaks = breaks_extended(8))+
  theme_bw() 



all_gender_rate <- population_2000_2020_int %>%
  filter( population_group %in% c("all_male","all_female"),
          year == 2019) %>%
  pivot_wider(names_from = population_group  , values_from = number) %>%
  mutate(rate = all_female/all_male, percent_female =all_female/(all_female+all_male) )

p_all_gender_rate<-all_gender_rate %>%
  ggplot(aes(age,rate)) +
  geom_path()+
  scale_color_brewer(palette = "Set1",  direction = -1)+
 scale_x_continuous(breaks = breaks_extended(8))+
  scale_y_continuous(limits = c(0.9,1.2))+
  theme_bw() 

p_all_gender/p_all_gender_rate

#ggsave("C:/R_projects/Israel popultion/plots/jews_by_gender.png")

```

עכשיו נראה איך התפלגות הגילאים של האוכלוסייה משתנה לפי שנה

```{r}
population_2000_2020_int %>%
          filter( population_group =="all_total" ) %>%
          ggplot(aes(age,number, color = year, group = year)) +
          geom_path()+
          facet_wrap(~year)+
           theme_bw() 
```

ההדמיה הקודמת מרגישה לי בעייתית כי קשה מאוד לעקוב אחרי השינוי משנה לשנה. בואו ננסה להציג את השינוי בגודל של כל גיל בדיד משנה לשנה

אחר כך אולי אפשר לחשב את הגודל של כל שנתון ואיך הוא השתנה

באיזה שהוא שלב נצטרך להפריד כאן בין השפעות של ילודה לבין השפעות של תמותה

```{r}

population_2000_2020_int %>%
          filter( population_group =="all_total" ) %>%
          ggplot(aes(year,number, color = year)) +
          geom_path()+
          facet_wrap(~age)+
           theme_bw() 

population_2000_2020_int %>%
          filter( population_group =="jews_and_others_total" , age >20 & age <50) %>%
          ggplot(aes(year,number, color = year)) +
          geom_path()+
          facet_wrap(~age)+
           theme_bw() 

population_2000_2020 %>%
          filter( population_group =="jews_and_others_total" , age %in% c("25-29", "30-34") ) %>%
          ggplot(aes(year,number)) +
          geom_path()+
          facet_wrap(~age)+
  scale_y_continuous(limits = c(0,500000),labels = label_comma())+
           theme_bw() 


population_2000_2020 %>%
          filter( population_group =="all_total" , age =="15-19" ) %>%
          ggplot(aes(year,number)) +
          geom_path()+
  scale_y_continuous(limits = c(0,800000),labels = label_comma())+
           theme_bw()

population_2000_2020 %>%
          filter( population_group =="all_total" , age =="16" ) %>%
          ggplot(aes(year,number)) +
          geom_path()+
  scale_y_continuous(limits = c(0,150000),labels = label_comma(), n.breaks = 7)+
           theme_bw()

```
